<html lang="en">

<head>
  <meta charset="UTF-8">
  

  
  <title>Elixir: Using Environment Variables</title>
  

  
  
  

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bitter:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">
  <link
    href="https://fonts.googleapis.com/css2?family=Lato:wght@100;300;700&display=swap"
    rel="stylesheet">

  <link class="stylesheet" rel="stylesheet" href="/main.css" />
  <link class="stylesheet" rel="stylesheet" href="/dark.css" />

  
    <link rel="alternate" type="application/atom+xml" title="Atom" href="https://mbuffa.github.io/atom.xml">
  

  
    <link rel="alternate" type="application/rss+xml" title="RSS" href="https://mbuffa.github.io/rss.xml">
  

  <meta name="description" content="A short guide about dealing with environment variables in your Elixir project" />
</head>

<body class="stylesheet-mode" onload="loadActiveStylesheet()">
  <script type="text/javascript">
    function getStylesheetModeTags() {
      return document.getElementsByClassName("stylesheet-mode");
    }

    function getStylesheetTogglerTags() {
      return document.getElementsByClassName("stylesheet-toggler");
    }

    function loadActiveStylesheet() {
      var activeStylesheet = localStorage.getItem("active-stylesheet");

      if (["dark", "light"].indexOf(activeStylesheet) == -1) {
        activeStylesheet = "dark";
      }

      var classes = "stylesheet-mode " + activeStylesheet;

      for (elem of getStylesheetModeTags()) {
        elem.setAttribute("class", classes);
      }

      updateGiscusStyle(activeStylesheet);
    }

    function getIconNameForMode(mode) {
      if (mode == "dark") {
        return "sunny";
      }
      return "moon";
    }

    function sendToIframe(iframe, message, url) {
      iframe.contentWindow.postMessage(message, url);
    }

    function sendToGiscus(message) {
      var iframe = document.querySelector("iframe.giscus-frame");

      // WORKAROUND:
      // If the iframe is loaded, we apply the new theme instantly.
      // If it's not, then we delay the loading, so that the default "dark"
      // theme won't override it once the iframe is loaded (on first page load).
      // SHORTCOMINGS:
      // This can display a dark Giscus inside a light page for a few seconds...
      // But it prevents displaying a broken form or duplicating the iframe.
      if (iframe) {
        sendToIframe(iframe, { giscus: message }, "https://giscus.app");
      } else {
        setTimeout(sendToGiscus, 3000, message)
      }
    }

    function updateGiscusStyle(mode) {
      var theme = mode == "dark" ? "dark" : "light";

      sendToGiscus({
        setConfig: {
          theme: theme
        }
      });
    }

    function switchStylesheets() {
      var activeMode = "dark";

      for (elem of getStylesheetModeTags()) {
        switch (elem.className) {
          case "stylesheet-mode dark":
            activeMode = "light";
            break;

          case "stylesheet-mode light":
            activeMode = "dark";
            break;

          default:
            activeMode = "dark";
            break;
        }

        elem.setAttribute("class", "stylesheet-mode " + activeMode);
      }

      localStorage.setItem("active-stylesheet", activeMode);
      updateGiscusStyle(activeMode);
    }
  </script>

  <script type="text/javascript">loadActiveStylesheet();</script>
  <div id='stars'></div>
  <div id='stars2'></div>
  <div id='stars3'></div>

  <main class="
      m-auto max-w-full h-screen overflow-y-scroll overflow-x-hidden
      text-black dark:text-white bg-blue-900 dark:bg-transparent
    ">
    <div class="w-228 max-w-screen m-auto p-4 bg-slate-200 dark:bg-transparent">
      <div class="
    sticky h-12 w-11/12 m-auto mt-4 mb-4 p-1 -top-px rounded-md
    bg-black bg-opacity-100 shadow-2xl
    dark:bg-black dark:bg-opacity-80 dark:shadow-transparent
">
  <nav class="h-full w-full relative">
    <ul
      class="w-full h-full m-auto p-0 flex flex-row flex-nowrap justify-center items-center list-none">
      
      
      <li>
        <a class="
            inline-block no-underline p-4 pt-1 pb-1 hover:no-underline border border-solid rounded-md border-transparent
            text-white hover:bg-white hover:text-black active:text-black
            dark:text-orange-500 dark:hover:bg-orange-500 dark:hover:text-neutral-900 dark:active:text-white"
          href="&#x2F;">Home</a>
      </li>
      
      <li>
        <a class="
            inline-block no-underline p-4 pt-1 pb-1 hover:no-underline border border-solid rounded-md border-transparent
            text-white hover:bg-white hover:text-black active:text-black
            dark:text-orange-500 dark:hover:bg-orange-500 dark:hover:text-neutral-900 dark:active:text-white"
          href="&#x2F;articles">Articles</a>
      </li>
      
      <li>
        <a class="
            inline-block no-underline p-4 pt-1 pb-1 hover:no-underline border border-solid rounded-md border-transparent
            text-white hover:bg-white hover:text-black active:text-black
            dark:text-orange-500 dark:hover:bg-orange-500 dark:hover:text-neutral-900 dark:active:text-white"
          href="&#x2F;demos">Demos</a>
      </li>
      
      <li>
        <a class="
            inline-block no-underline p-4 pt-1 pb-1 hover:no-underline border border-solid rounded-md border-transparent
            text-white hover:bg-white hover:text-black active:text-black
            dark:text-orange-500 dark:hover:bg-orange-500 dark:hover:text-neutral-900 dark:active:text-white"
          href="&#x2F;tags">Tags</a>
      </li>
      
      <li>
        <a class="
            inline-block no-underline p-4 pt-1 pb-1 hover:no-underline border border-solid rounded-md border-transparent
            text-white hover:bg-white hover:text-black active:text-black
            dark:text-orange-500 dark:hover:bg-orange-500 dark:hover:text-neutral-900 dark:active:text-white"
          href="&#x2F;contact">Contact</a>
      </li>
      
      <li class="ml-auto">
        <a class="
            inline-block no-underline p-1 hover:no-underline border border-solid rounded-md border-transparent
            text-white hover:bg-white hover:text-black active:text-black
          dark:text-orange-500 dark:hover:bg-orange-500 dark:hover:text-neutral-900 dark:active:text-white"
          onClick="switchStylesheets()">
          <ion-icon class="stylesheet-toggler inline-block dark:hidden"
            name="moon"></ion-icon>
          <ion-icon class="stylesheet-toggler hidden dark:inline-block"
            name="sunny"></ion-icon>
        </a>
      </li>
    </ul>
  </nav>
</div>

      <div class="
        w-11/12 m-auto mt-2 p-4
        flex justify-center
        flex-col flex-wrap
        lg:flex-row lg:flex-nowrap
        dark:bg-black dark:bg-opacity-60
    ">
        


<aside class="w-full lg:w-3/12">
  <div class="sticky flex top-50">
    <ol class="w-full m-0 pl-4 list-decimal">
      
      <li>
        
<a class="
    inline-block px-2 text-sm w-full underline hover:no-underline
  dark:text-orange-500 dark:hover:text-orange-500 dark:hover:bg-neutral-900"
  href="https://mbuffa.github.io/articles/20210916-elixir-environment-variables/#context" title="Context">
  Context
</a>

        
      </li>
      
      <li>
        
<a class="
    inline-block px-2 text-sm w-full underline hover:no-underline
  dark:text-orange-500 dark:hover:text-orange-500 dark:hover:bg-neutral-900"
  href="https://mbuffa.github.io/articles/20210916-elixir-environment-variables/#what-happened" title="What happened">
  What happened
</a>

        
      </li>
      
      <li>
        
<a class="
    inline-block px-2 text-sm w-full underline hover:no-underline
  dark:text-orange-500 dark:hover:text-orange-500 dark:hover:bg-neutral-900"
  href="https://mbuffa.github.io/articles/20210916-elixir-environment-variables/#solutions" title="Solutions">
  Solutions
</a>

        
      </li>
      
      <li>
        
<a class="
    inline-block px-2 text-sm w-full underline hover:no-underline
  dark:text-orange-500 dark:hover:text-orange-500 dark:hover:bg-neutral-900"
  href="https://mbuffa.github.io/articles/20210916-elixir-environment-variables/#2025-update" title="2025 Update">
  2025 Update
</a>

        
      </li>
      
    </ol>
  </div>
</aside>



<article class="w-full lg:w-9/12 pt-1 pb-1 pl-4">

  <header class="text-center">
    <h1 class="text-2xl font-bold m-2 p-2">
      Elixir: Using Environment Variables
    </h1>
    
    <p class="subtitle">
      Published on 2021-09-16
    </p>
    
    
    
<p class="max-w-fit m-auto">
  
  <a class="inline-block m-1 p-1 underline hover:no-underline"
    href="/tags/tutorial">
    tutorial
  </a>
  
  <a class="inline-block m-1 p-1 underline hover:no-underline"
    href="/tags/elixir">
    elixir
  </a>
  
</p>

    
    <p class="m-2 p-2">
      <a href="/atom.xml"
         class="text-orange-500 hover:text-orange-600 dark:text-orange-500 dark:hover:text-orange-400 underline hover:no-underline"
         title="Subscribe to Atom feed">
        Atom Feed
      </a>
      <span>&middot;</span>
      <a href="/rss.xml"
         class="text-orange-500 hover:text-orange-600 dark:text-orange-500 dark:hover:text-orange-400 underline hover:no-underline"
         title="Subscribe to RSS feed">
        RSS Feed
      </a>
    </p>
  </header>

  

  

  

  <div class="markdown-content">
    <h2 id="context">Context</h2>
<p>An environment variable is a widespread programming concept that refers to a value coming from the system, being read by an application at runtime. Elixir can be a bit surprising on that aspect for beginners.</p>
<p>This is one way of accessing an environment variable:</p>
<pre style="background-color:#2b303b;color:#c0c5ce;"><code><span>&gt; HELLO=world iex
</span><span>iex(1)&gt; System.get_env(&quot;HELLO&quot;)
</span><span>&quot;world&quot;
</span></code></pre>
<p>And the same call would work in your application source code.</p>
<p>However, you may want to avoid scattering those calls in every corner, and use a config file instead to centralize your settings and your default values.</p>
<p>Mix doesn't generate config files by default, so you'd have to create one of those, like this:</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">mix</span><span> new foo
</span><span style="color:#96b5b4;">cd</span><span> foo
</span><span style="color:#bf616a;">mkdir</span><span> config
</span><span style="color:#bf616a;">touch</span><span> config/config.exs
</span></code></pre>
<p>And edit your <code>config/config.exs</code> file, like this:</p>
<pre data-lang="elixir" style="background-color:#2b303b;color:#c0c5ce;" class="language-elixir "><code class="language-elixir" data-lang="elixir"><span style="color:#b48ead;">import </span><span style="color:#ebcb8b;">Config
</span><span>
</span><span>config </span><span style="color:#a3be8c;">:foo</span><span>, </span><span style="color:#d08770;">hello: </span><span style="color:#ebcb8b;">System</span><span>.get_env(&quot;</span><span style="color:#a3be8c;">HELLO</span><span>&quot;)
</span></code></pre>
<p>And lastly, modify <code>lib/foo.ex</code> like this, to actually use the key-value pair we defined:</p>
<pre data-lang="elixir" style="background-color:#2b303b;color:#c0c5ce;" class="language-elixir "><code class="language-elixir" data-lang="elixir"><span>module </span><span style="color:#ebcb8b;">Foo </span><span style="color:#b48ead;">do
</span><span style="color:#65737e;">  # ...
</span><span>  </span><span style="color:#b48ead;">def </span><span style="color:#8fa1b3;">hello </span><span style="color:#b48ead;">do
</span><span>    </span><span style="color:#ebcb8b;">Application</span><span>.get_env(</span><span style="color:#a3be8c;">:foo</span><span>, </span><span style="color:#a3be8c;">:hello</span><span>, &quot;</span><span style="color:#a3be8c;">default</span><span>&quot;)
</span><span>  </span><span style="color:#b48ead;">end
</span><span style="color:#b48ead;">end
</span></code></pre>
<p>Now, we want to produce a build, but let's define our environment variable just before we do that:</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#b48ead;">export </span><span style="color:#bf616a;">HELLO</span><span>=</span><span style="color:#a3be8c;">foo
</span><span style="color:#bf616a;">MIX_ENV</span><span>=</span><span style="color:#a3be8c;">prod </span><span style="color:#bf616a;">mix</span><span> release
</span></code></pre>
<p>Now let's run an interactive terminal to our build, and let's override that env variable along the way:</p>
<pre data-lang="sh" style="background-color:#2b303b;color:#c0c5ce;" class="language-sh "><code class="language-sh" data-lang="sh"><span style="color:#bf616a;">HELLO</span><span>=</span><span style="color:#a3be8c;">bar </span><span style="color:#bf616a;">./_build/prod/rel/foo/bin/foo</span><span> start_iex
</span></code></pre>
<p>There, calling <code>Foo.hello</code> would return "foo", not "bar".</p>
<p>You can easily get surprises when releasing your first Elixir app, because this is not something you can reliably reproduce with <code>iex -S mix</code> locally.</p>
<h2 id="what-happened">What happened</h2>
<p>Well basically, <code>exs</code> files are script files: they're used at build or test times, and aren't present in your final build. When building your release, Mix interpreted <code>System.get_env</code> directly and hardcoded the value.</p>
<h2 id="solutions">Solutions</h2>
<p>One exception to that is the Elixir 1.11 addition <code>config/runtime.exs</code> file, meant to be "compiled" at runtime.</p>
<p>Of course, you could argue that using <code>System.get_env</code> directly in your source code would work, but I would say this wouldn't be a great idea ;-)</p>
<p>There's an alternative to <code>config/runtime.exs</code> though, <a href="https://hex.pm/packages/env">which is the <code>env</code> library</a>. It lets you define tuples in your config files, and a getter similar to <code>Application.get_env</code>:</p>
<pre data-lang="elixir" style="background-color:#2b303b;color:#c0c5ce;" class="language-elixir "><code class="language-elixir" data-lang="elixir"><span style="color:#65737e;"># In your config files:
</span><span style="color:#b48ead;">import </span><span style="color:#ebcb8b;">Config
</span><span>
</span><span>config </span><span style="color:#a3be8c;">:test</span><span>, </span><span style="color:#d08770;">hello: </span><span>{</span><span style="color:#a3be8c;">:system</span><span>, &quot;</span><span style="color:#a3be8c;">HELLO</span><span>&quot;, &quot;</span><span style="color:#a3be8c;">world</span><span>&quot;}
</span><span>
</span><span style="color:#65737e;"># In your codebase:
</span><span style="color:#ebcb8b;">Env</span><span>.fetch(</span><span style="color:#a3be8c;">:test</span><span>, </span><span style="color:#a3be8c;">:hello</span><span>)
</span></code></pre>
<p><em>Et voil√† !</em> Hope this helps.</p>
<p>If you want to know more about Elixir builds and releases, as always, <a href="https://hexdocs.pm/mix/1.12/Mix.Tasks.Release.html">the official documentation is a great place to start</a>.</p>
<h2 id="2025-update">2025 Update</h2>
<p>I wanted to make an update a while ago to state one thing: you probably don't need a library such as <code>env</code> in your application. You just have to remember the following statements:</p>
<ul>
<li>Your configuration is split between environments (<code>config/{dev,test,prod}.exs</code>) which is built at compilation time</li>
<li>You have to make sure your environment variables are defined at compilation time if you make calls to <code>System.get_env</code>, otherwise, your config would contain empty settings. You can check <a href="/articles/20250227-loading-env-without-leaks">this article</a> for the most optimal way to do that locally.</li>
<li>There's one exception to that: <code>config/runtime.exs</code> is <em>always</em> evaluated at runtime, and not only in production. This is where you can reliably call <code>System.get_env</code>. Just be cautious and insert production configuration inside the right "block" in there, because it's also used for dev and test.</li>
</ul>
<p>There's actually another exception you may come across in older Elixir projects, which is <code>config/releases.exs</code>, used until Elixir v1.11.0.</p>
<p>Finally, checking both <a href="https://hexdocs.pm/elixir/config-and-releases.html">Elixir</a> and <a href="https://hexdocs.pm/mix/1.18.4/Mix.Tasks.Release.html">Mix</a> documentations for your versions is always a good idea.</p>

  </div>

  
  <script src="https://giscus.app/client.js"
    data-repo="mbuffa/mbuffa.github.io"
    data-repo-id="MDEwOlJlcG9zaXRvcnkyNDYzOTIyNjU="
    data-category="Announcements" data-category-id="DIC_kwDODq-lyc4CAZ1r"
    data-mapping="title" data-reactions-enabled="1" data-emit-metadata="0"
    data-theme="dark" data-lang="en" crossorigin="anonymous" async>
    </script>
  
</article>

      </div>

      <footer class="mt-20 p-4 text-center text-xs font-normal">
  <span>
    Written by Maxime Buffa with <a class="dark:text-orange-500 dark:hover:text-orange-500 dark:hover:bg-neutral-900"
      href="https://www.getzola.org/" target="_blank">Zola</a> and <a
      class="dark:text-orange-500 dark:hover:text-orange-500 dark:hover:bg-neutral-900" href="https://tailwindcss.com/"
      target="_blank">Tailwind</a>
  </span>
</footer>
    </div>
    <!-- Fix to avoid scrolling "under the overflow break" when using a ToC link.
    <br>
  </main>

  <!-- Heap Analytics loader -->
    <script type="text/javascript">
      window.heap = window.heap || [], heap.load = function (e, t) { window.heap.appid = e, window.heap.config = t = t || {}; var r = document.createElement("script"); r.type = "text/javascript", r.async = !0, r.src = "https://cdn.heapanalytics.com/js/heap-" + e + ".js"; var a = document.getElementsByTagName("script")[0]; a.parentNode.insertBefore(r, a); for (var n = function (e) { return function () { heap.push([e].concat(Array.prototype.slice.call(arguments, 0))) } }, p = ["addEventProperties", "addUserProperties", "clearEventProperties", "identify", "resetIdentity", "removeEventProperty", "setEventProperties", "track", "unsetEventProperty"], o = 0; o < p.length; o++)heap[p[o]] = n(p[o]) };
      heap.load("4008293954");
    </script>
    <script
      src="https://unpkg.com/ionicons@5.2.3/dist/ionicons/ionicons.js"></script>
    <script type="module"
      src="https://unpkg.com/ionicons@5.2.3/dist/ionicons/ionicons.esm.js"></script>
</body>

</html>